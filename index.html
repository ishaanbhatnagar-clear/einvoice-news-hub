<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eInvoice News Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a1f2e;
            --border: rgba(136, 146, 176, 0.15);
            --text-primary: #f0f4ff;
            --text-secondary: #8892b0;
            --accent-red: #ff4d4d;
            --accent-cyan: #14b8a6;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        [x-cloak] { display: none !important; }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        .card:hover {
            border-color: rgba(136, 146, 176, 0.3);
            transform: translateY(-1px);
        }
        .news-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem;
        }
        @media (min-width: 768px) {
            .news-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 1024px) {
            .news-grid { grid-template-columns: repeat(3, 1fr); }
        }
        .filter-dropdown {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        input[type="checkbox"] {
            accent-color: var(--accent-cyan);
        }
        ::selection {
            background: rgba(20, 184, 166, 0.3);
        }
        @keyframes progress {
            0% { width: 0%; margin-left: 0; }
            50% { width: 60%; margin-left: 20%; }
            100% { width: 0%; margin-left: 100%; }
        }
        .animate-progress {
            animation: progress 1.5s ease-in-out infinite;
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 4px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: {
                            900: '#0a0f1a',
                            800: '#111827',
                            700: '#1a1f2e',
                            600: '#252b3b'
                        },
                        accent: {
                            red: '#ff4d4d',
                            cyan: '#14b8a6'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen" x-data="newsApp()" x-init="init()">
    <!-- Header -->
    <header class="border-b border-white/10 sticky top-0 z-50 bg-dark-900/95 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-accent-cyan to-teal-600 flex items-center justify-center">
                        <span class="text-white font-bold text-sm">eI</span>
                    </div>
                    <span class="text-lg font-semibold text-white">eInvoice News</span>
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <div class="relative">
                        <input
                            type="text"
                            x-model="searchQuery"
                            @input="filterNews()"
                            placeholder="Search..."
                            class="w-48 bg-dark-800 border border-white/10 rounded-lg px-4 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-accent-cyan/50"
                        >
                    </div>

                    <div class="flex items-center space-x-2 text-xs text-gray-500">
                        <div class="w-1.5 h-1.5 rounded-full bg-accent-cyan animate-pulse"></div>
                        <span class="mono" x-text="filteredArticles.length + ' articles'"></span>
                    </div>

                    <!-- Refresh Button -->
                    <button
                        @click="refreshNews()"
                        :disabled="refreshing"
                        class="flex items-center space-x-1.5 px-3 py-1.5 bg-dark-800 border border-white/10 rounded-lg text-sm text-gray-400 hover:text-white hover:border-accent-cyan/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                        title="Trigger crawl and refresh news"
                    >
                        <svg
                            class="w-4 h-4"
                            :class="{ 'animate-spin': refreshing }"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span x-text="refreshStatus || (refreshing ? 'Refreshing...' : 'Refresh')"></span>
                    </button>

                    <button @click="logout()" class="text-gray-500 hover:text-white transition-colors" title="Logout">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div x-show="refreshing" x-cloak class="fixed top-[65px] left-0 right-0 z-40">
        <div class="h-1 bg-dark-800">
            <div class="h-full bg-gradient-to-r from-accent-cyan to-teal-500 animate-progress"></div>
        </div>
    </div>

    <!-- Filters -->
    <div class="border-b border-white/10 bg-dark-900">
        <div class="max-w-7xl mx-auto px-6 py-3">
            <div class="flex flex-wrap items-center gap-3">

                <!-- Multi-select Region Filter -->
                <div class="relative" x-data="{ open: false }" @click.away="open = false">
                    <button @click="open = !open" class="filter-dropdown flex items-center space-x-2 px-4 py-2 rounded-lg text-sm text-gray-300 hover:text-white transition-colors">
                        <span>Regions</span>
                        <span x-show="selectedRegions.length > 0" class="bg-accent-cyan/20 text-accent-cyan px-1.5 py-0.5 rounded text-xs mono" x-text="selectedRegions.length"></span>
                        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="open" x-cloak class="absolute top-full left-0 mt-2 w-56 bg-dark-800 border border-white/10 rounded-lg shadow-xl z-50 py-2 max-h-64 overflow-y-auto scrollbar-thin">
                        <template x-for="region in regions" :key="region.id">
                            <label class="flex items-center px-4 py-2 hover:bg-white/5 cursor-pointer">
                                <input type="checkbox" :value="region.id" x-model="selectedRegions" @change="filterNews()" class="mr-3 rounded">
                                <span class="text-sm text-gray-300" x-text="region.name"></span>
                            </label>
                        </template>
                    </div>
                </div>

                <!-- Multi-select Source Filter -->
                <div class="relative" x-data="{ open: false }" @click.away="open = false">
                    <button @click="open = !open" class="filter-dropdown flex items-center space-x-2 px-4 py-2 rounded-lg text-sm text-gray-300 hover:text-white transition-colors">
                        <span>Sources</span>
                        <span x-show="selectedSources.length > 0" class="bg-accent-cyan/20 text-accent-cyan px-1.5 py-0.5 rounded text-xs mono" x-text="selectedSources.length"></span>
                        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="open" x-cloak class="absolute top-full left-0 mt-2 w-64 bg-dark-800 border border-white/10 rounded-lg shadow-xl z-50 py-2 max-h-64 overflow-y-auto scrollbar-thin">
                        <template x-for="source in sources" :key="source.id">
                            <label class="flex items-center px-4 py-2 hover:bg-white/5 cursor-pointer">
                                <input type="checkbox" :value="source.id" x-model="selectedSources" @change="filterNews()" class="mr-3 rounded">
                                <span class="text-sm text-gray-300" x-text="source.name"></span>
                                <span class="ml-auto text-xs text-gray-600 capitalize" x-text="source.type"></span>
                            </label>
                        </template>
                    </div>
                </div>

                <!-- Topic Filter -->
                <div class="relative" x-data="{ open: false }" @click.away="open = false">
                    <button @click="open = !open" class="filter-dropdown flex items-center space-x-2 px-4 py-2 rounded-lg text-sm text-gray-300 hover:text-white transition-colors">
                        <span>Topics</span>
                        <span x-show="selectedCategories.length > 0" class="bg-accent-cyan/20 text-accent-cyan px-1.5 py-0.5 rounded text-xs mono" x-text="selectedCategories.length"></span>
                        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="open" x-cloak class="absolute top-full left-0 mt-2 w-48 bg-dark-800 border border-white/10 rounded-lg shadow-xl z-50 py-2">
                        <template x-for="cat in categories" :key="cat.id">
                            <label class="flex items-center px-4 py-2 hover:bg-white/5 cursor-pointer">
                                <input type="checkbox" :value="cat.id" x-model="selectedCategories" @change="filterNews()" class="mr-3 rounded">
                                <span class="text-sm text-gray-300" x-text="cat.name"></span>
                            </label>
                        </template>
                    </div>
                </div>

                <!-- Time Range -->
                <select x-model="filters.timeRange" @change="filterNews()" class="filter-dropdown rounded-lg px-4 py-2 text-sm text-gray-300 focus:outline-none cursor-pointer">
                    <option value="">All time</option>
                    <option value="1">24 hours</option>
                    <option value="7">7 days</option>
                    <option value="30">30 days</option>
                </select>

                <!-- Clear -->
                <button x-show="hasActiveFilters()" @click="clearFilters()" class="text-sm text-accent-red hover:text-red-400 transition-colors">
                    Clear all
                </button>

                <!-- Last updated -->
                <span class="ml-auto text-xs text-gray-600 mono">
                    Updated <span x-text="getRelativeTime(newsData.lastUpdated)"></span>
                </span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Loading -->
        <div x-show="loading" class="flex items-center justify-center py-32">
            <div class="w-6 h-6 border-2 border-accent-cyan/30 border-t-accent-cyan rounded-full animate-spin"></div>
        </div>

        <div x-show="!loading" x-cloak class="space-y-12">

            <!-- Government & Official -->
            <section x-show="getGovtNews().length > 0">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 rounded-full bg-accent-red"></div>
                        <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Government & Official</h2>
                    </div>
                    <span class="text-xs text-gray-600 mono" x-text="getGovtNews().length + ' updates'"></span>
                </div>

                <div class="news-grid">
                    <template x-for="article in getGovtNews()" :key="article.id">
                        <a :href="article.url" target="_blank" rel="noopener" class="card rounded-xl p-5 block group min-h-[220px] flex flex-col">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg" x-text="getCountryFlag(article.country)"></span>
                                    <span class="text-sm text-gray-400" x-text="article.countryName"></span>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400 mono" x-text="formatShortDate(article.publishedAt)"></div>
                                    <div class="text-xs text-gray-600 mono" x-text="'Fetched ' + getRelativeTime(article.crawledAt)"></div>
                                </div>
                            </div>
                            <h3 class="text-white font-medium line-clamp-2 mb-2 group-hover:text-accent-cyan transition-colors" x-text="article.title"></h3>
                            <p class="text-sm text-gray-500 line-clamp-3 flex-1" x-text="article.summary"></p>
                            <div class="flex items-center justify-between pt-3 mt-auto border-t border-white/5">
                                <span class="text-xs text-accent-red font-medium" x-text="article.source.name"></span>
                                <svg class="w-4 h-4 text-gray-600 group-hover:text-accent-cyan group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                                </svg>
                            </div>
                        </a>
                    </template>
                </div>
            </section>

            <!-- News & Advisory -->
            <section x-show="getOtherNews().length > 0">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                        <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wider">News & Advisory</h2>
                    </div>
                    <span class="text-xs text-gray-600 mono" x-text="getOtherNews().length + ' updates'"></span>
                </div>

                <div class="news-grid">
                    <template x-for="article in getOtherNews()" :key="article.id">
                        <a :href="article.url" target="_blank" rel="noopener" class="card rounded-xl p-5 block group min-h-[220px] flex flex-col">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg" x-text="getCountryFlag(article.country)"></span>
                                    <span class="text-sm text-gray-400" x-text="article.countryName || 'Global'"></span>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400 mono" x-text="formatShortDate(article.publishedAt)"></div>
                                    <div class="text-xs text-gray-600 mono" x-text="'Fetched ' + getRelativeTime(article.crawledAt)"></div>
                                </div>
                            </div>
                            <h3 class="text-white font-medium line-clamp-2 mb-2 group-hover:text-accent-cyan transition-colors" x-text="article.title"></h3>
                            <p class="text-sm text-gray-500 line-clamp-3 flex-1" x-text="article.summary"></p>
                            <div class="flex items-center justify-between pt-3 mt-auto border-t border-white/5">
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-blue-400 font-medium" x-text="article.source.name"></span>
                                    <span class="text-xs text-gray-600 capitalize" x-text="article.source.type"></span>
                                </div>
                                <svg class="w-4 h-4 text-gray-600 group-hover:text-accent-cyan group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                                </svg>
                            </div>
                        </a>
                    </template>
                </div>
            </section>

            <!-- Vendor Updates -->
            <section x-show="getVendorNews().length > 0">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 rounded-full bg-purple-500"></div>
                        <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Vendor Updates</h2>
                    </div>
                    <span class="text-xs text-gray-600 mono" x-text="getVendorNews().length + ' updates'"></span>
                </div>

                <div class="news-grid">
                    <template x-for="article in getVendorNews()" :key="article.id">
                        <a :href="article.url" target="_blank" rel="noopener" class="card rounded-xl p-5 block group min-h-[220px] flex flex-col">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-2">
                                    <span class="w-6 h-6 rounded bg-purple-500/20 flex items-center justify-center text-xs font-medium text-purple-400" x-text="article.source.name.charAt(0)"></span>
                                    <span class="text-sm text-purple-400" x-text="article.source.name"></span>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400 mono" x-text="formatShortDate(article.publishedAt)"></div>
                                    <div class="text-xs text-gray-600 mono" x-text="'Fetched ' + getRelativeTime(article.crawledAt)"></div>
                                </div>
                            </div>
                            <h3 class="text-white font-medium line-clamp-2 mb-2 group-hover:text-accent-cyan transition-colors" x-text="article.title"></h3>
                            <p class="text-sm text-gray-500 line-clamp-3 flex-1" x-text="article.summary"></p>
                            <div class="flex items-center justify-between pt-3 mt-auto border-t border-white/5">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg" x-text="getCountryFlag(article.country)"></span>
                                    <span class="text-xs text-gray-500" x-text="article.countryName || 'Global'"></span>
                                </div>
                                <svg class="w-4 h-4 text-gray-600 group-hover:text-accent-cyan group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                                </svg>
                            </div>
                        </a>
                    </template>
                </div>
            </section>

            <!-- Empty State -->
            <div x-show="filteredArticles.length === 0" class="text-center py-20">
                <div class="text-gray-600 mb-4">
                    <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <p class="text-gray-500 mb-4">No articles match your filters</p>
                <button @click="clearFilters()" class="text-sm text-accent-cyan hover:underline">
                    Clear all filters
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-white/5 mt-16">
        <div class="max-w-7xl mx-auto px-6 py-6">
            <div class="flex items-center justify-between text-xs text-gray-600">
                <span>Aggregating e-invoicing intelligence globally</span>
                <div class="flex items-center space-x-4">
                    <a href="changelog.html" class="text-accent-cyan hover:underline">Changelog</a>
                    <span class="mono">Last sync: <span x-text="formatDate(newsData.lastUpdated)"></span></span>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
